<html><head><title>dynamics-client: entity</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="aappddeevv" /><meta name="description" content="A Microsoft Dynamics CLI swiss-army knife and browser/server library." /><meta name="og:image" content="/dynamics-client/img/poster.png" /><meta name="og:title" content="dynamics-client: entity" /><meta name="og:site_name" content="dynamics-client" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="A Microsoft Dynamics CLI swiss-army knife and browser/server library." /><link rel="icon" type="image/png" href="/dynamics-client/img/favicon.png" /><meta name="twitter:title" content="dynamics-client: entity" /><meta name="twitter:image" content="img/poster.png" /><meta name="twitter:description" content="A Microsoft Dynamics CLI swiss-army knife and browser/server library." /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/dynamics-client/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/dynamics-client/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/dynamics-client/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/dynamics-client/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/dynamics-client/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/dynamics-client/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/dynamics-client/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/dynamics-client/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/dynamics-client/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/dynamics-client/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/dynamics-client/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/dynamics-client/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/dynamics-client/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/dynamics-client/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/dynamics-client/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/dynamics-client/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/dynamics-client/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/dynamics-client/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/dynamics-client/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/dynamics-client/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/dynamics-client/highlight/styles/default.css" /><link rel="stylesheet" href="/dynamics-client/css/style.css" /><link rel="stylesheet" href="/dynamics-client/css/palette.css" /><link rel="stylesheet" href="/dynamics-client/css/codemirror.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/dynamics-client/" class="brand"><div class="brand-wrapper"><span>dynamics-client</span></div></a></li> <li><a href="/dynamics-client/docs/index.html" class="">Getting Started</a></li> <li><a href="/dynamics-client/docs/actions.html" class="">actions</a></li> <li><a href="/dynamics-client/docs/applications.html" class="">applications</a></li> <li><a href="/dynamics-client/docs/entity.html" class=" active ">entity</a></li> <li><a href="/dynamics-client/docs/importdata.html" class="">importdata</a></li> <li><a href="/dynamics-client/docs/importmaps.html" class="">importmaps</a></li> <li><a href="/dynamics-client/docs/plugins.html" class="">plugins</a></li> <li><a href="/dynamics-client/docs/settings.html" class="">settings</a></li> <li><a href="/dynamics-client/docs/solutions.html" class="">solutions</a></li> <li><a href="/dynamics-client/docs/systemjobs.html" class="">systemjobs</a></li> <li><a href="/dynamics-client/docs/themes.html" class="">themes</a></li> <li><a href="/dynamics-client/docs/update.html" class="">update</a></li> <li><a href="/dynamics-client/docs/users.html" class="">users</a></li> <li><a href="/dynamics-client/docs/webresources.html" class="">webresources</a></li> <li><a href="/dynamics-client/docs/workflows.html" class="">workflows</a></li> <li><a href="/dynamics-client/docs/solutiondeployment.html" class="">Deployment Scripts</a></li> <li><a href="/dynamics-client/docs/examples.html" class="">Example Usage Scenarios</a></li> <li><a href="/dynamics-client/docs/creatingacustomcli.html" class="">Create your own CLI</a></li> <li><a href="/dynamics-client/docs/etl.html" class="">Simple ETL Programs</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/aappddeevv/dynamics-client"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/aappddeevv/dynamics-client"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('dynamics-client A Microsoft Dynamics CLI swiss-army knife and browser/server library.');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('dynamics-client A Microsoft Dynamics CLI swiss-army knife and browser/server library.');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="aappddeevv" data-github-repo="dynamics-client"><div class="content-wrapper"><section><p>The <code class="highlighter-rouge">entity</code> command allows you to export data from a CRM server at fairly high
speed. You can export in CSV or JSON format using a web api query that you
specify on the command line or through CLI args that will compose the web api
query string for you.</p>

<h2 id="subcommands">Subcommands</h2>
<ul>
  <li>export: Export entity data. Command line options allow you to build up a query
using web api fragments. dynamicscli will stitch them together. Output is csv.</li>
  <li>export-from-query: Provide a web api query to specify the data to export. It
can be trick to properly single quote value inside the web api query so watch
your OS shell expansion carefully. The only output format is json.</li>
  <li>count: Count the number of entities. If you provide the –repeat option, it
will continuously count entities, which can be resource intensive so use
–repeat wisely. You can provide a list of entities to count. Count requests
are run in parallel.</li>
  <li>delete: Delete data by providing a query. If you created a load id for your
data loads or use the builtin load id, you can delete a slice of the data
based on the id. Otherwise, the query must return the primary key which will
be used to issue the delete commands. It is suggested that you first run count
or export the entities you want to delete to ensure your delete query will
select the correct records.</li>
</ul>

<h3 id="count">count</h3>
<p>You can specify any/all <code class="highlighter-rouge">--query</code>, <code class="highlighter-rouge">--query-file</code> or ``–filter` to select the entities to count.</p>

<ul>
  <li><code class="highlighter-rouge">--query</code>: key=value pairs. The key will be used to sort the count results.</li>
  <li><code class="highlighter-rouge">--query-file</code>: A JSON file with key, value pairs.</li>
  <li><code class="highlighter-rouge">--filter</code>: Specify only the entity. A query will be created e.g. <code class="highlighter-rouge">--filter contact</code> === <code class="highlighter-rouge">--query contact='/contacts?$select=contactid</code>.</li>
  <li><code class="highlighter-rouge">--function</code> with <code class="highlighter-rouge">--filter</code>: Use the fast function approach, but if you do, you cannot use queries to count, you can only count the entire entity.</li>
</ul>

<p>Shell expansion can make specifying the query difficult on the command
line. <code class="highlighter-rouge">--query-file</code> allows you to use single quotes in your query much
easier. For example to count the number of customeraddress entities for the
account entity where an account has more than 2 addresses (since 2 are always
created):</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
        </span><span class="nt">"accountAddressGt2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/customeraddresses?$select=customeraddressid&amp;$filter=addressnumber gt 2 and objecttypecode eq 'account'"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"accountAddress"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/customeraddresses?$select=customeraddressid&amp;$filter=objecttypecode eq 'account'"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>which you can run counts using:</p>

<div class="language-sh highlighter-rouge"><pre class="highlight"><code>dynamicscli entity count --query-file addressqueries.json
...
accountAddress, 1000
accountAddressGt2, 100
...
</code></pre>
</div>

<p>I often use counts when I think there is a load issue. For example, I was
concerned that a load set the ownerid incorrectly, so I ran a count:</p>

<div class="language-sh highlighter-rouge"><pre class="highlight"><code>dynamicscli entity count --query <span class="nv">c</span><span class="o">=</span><span class="s1">'/mycustomactivity?$select=activityid&amp;$filter=_ownerid_value eq 9f077006-2fe5-44e4-b836-54a542743460'</span>
</code></pre>
</div>

<p>You cannot use navigation properties to in the queries to count child
entities. Reverse the query and run the count on the child record.</p>

<p>Note that there is a function provided in the API to count objects but it does
not take ‘query’ arguments so its not overly useful. It is very fast though, so
if you need to count the entire set of entities, use it:</p>

<div class="language-sh highlighter-rouge"><pre class="highlight"><code>dynamicscli entity count --function <span class="nb">true</span> --filter contact,account
</code></pre>
</div>

<h3 id="export-export-from-query">export, export-from-query</h3>
<p>Exporting data comes in two flavors. Exporting using a query created from parts
on the command line and using a fully formed query. You can export data into a
CSV or JSON streaming file.</p>

<p>Both of these options take:</p>
<ul>
  <li>include-formatted-values: Include formatted values in the output.</li>
  <li>max-page-size: The pagesize to use when retrieving data. You should use the
default unless you see stack or heap errors. Either increase the head/stack or
decrease max-page-size to fix.</li>
</ul>

<h4 id="export">export</h4>
<p>You can dump a single json object using <code class="highlighter-rouge">--raw</code> in order to see some example
output. Then use the rest of the parameters to compose a web api query to select
data to be exported.</p>

<p>Examples:</p>
<ul>
  <li><code class="highlighter-rouge">dynamicscli entity export contacts --outputfile contacts.csv</code>: Export all contacts to csv file.</li>
</ul>

<h4 id="export-from-query">export-from-query</h4>
<ul>
  <li>query: Specify the query here. Watch out for shell escapes if you use single
quotes on linux. You can limit results using $top.</li>
  <li>wrap: Wrap the output in json array brackets and separate records with a
comma.</li>
  <li>skip: While highly inefficient, this will skip the first N records. There’s no
clever way to jump to a results page efficiently.</li>
</ul>

<p>The default is to output JSON strings separated by newlines.</p>

<p>Examples:</p>
<ul>
  <li><code class="highlighter-rouge">dynamicscli entity export-from-query '/contacts' --outputfile contacts-from-query.json</code>: Dump all contacts to json file.</li>
</ul>

<h3 id="delete">delete</h3>
<p>By providing a web api, you can delete those records selected by the query. Each
query must return the primary key in the query and you must specify which entity
you are deleting so that the metadata for the entity can be looked up and the
primary key identified correctly.</p>

<ul>
  <li><code class="highlighter-rouge">--query</code> and <code class="highlighter-rouge">--entity</code>: Specify these to delete records based on a query and
the entity specified.</li>
  <li><code class="highlighter-rouge">--query-file</code>: Create a CSV file that has two columns title, “entity” and
“query”. Make sure you properly handle embedded commas. dynamicscli will read
the csv file and delete the records specified in the queries in the order
specified.</li>
</ul>

<p>The current version does not use the OData batch to delete the records so a
concurrency factor much higher than the default should be used e.g. 100.</p>

<p>The number of deleted records and the respective query are printed as output.</p>

<p>Here’s an example query file:</p>

<div class="language-text highlighter-rouge"><pre class="highlight"><code>entity,query
contact,/contacts?$select=contactid&amp;$filter=age gt 25
account,/accounts?$select=accountid&amp;$filter=importsequencenumber eq 20
</code></pre>
</div>

<p>Note that you can run a bulk delete job directly on CRM and use a sophisticated
FetchXml query. This delete functionality is designed to handle simple delete
scenarios that you often run into after a bad data load in a script.</p>

<h2 id="examples">Examples</h2>

<h2 id="future">Future</h2>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/dynamics-client/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script src="/dynamics-client/js/main.js"></script></body></html>